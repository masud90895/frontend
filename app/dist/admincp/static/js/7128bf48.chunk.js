"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["packages_framework_metafox-lexical_src_components_ImageComponent_tsx"],{29302:function(e,t,r){r.r(t),r.d(t,{$getAncestor:function(){return I},INSERT_LINK_IMAGE_COMMAND:function(){return P},RIGHT_CLICK_IMAGE_COMMAND:function(){return L},default:function(){return O}});var l,n=r(16299),a=r(95356),i=r(90893),o=r(30758);let s=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],u=s[Math.floor(Math.random()*s.length)],c=(0,o.createContext)({clientID:0,color:u[1],isCollabActive:!1,name:u[0],yjsDocMap:new Map});var d=r(86070),m=(l=function(e){let t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}).__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l;function f(e){let t=e.transform();return null!==t?new Set([t]):new Set}function g({initialEditor:e,children:t,initialNodes:r,initialTheme:l,skipCollabChecks:n}){let i=(0,o.useRef)(!1),s=(0,o.useContext)(a.Gu);null==s&&m(9);let[u,{getTheme:g}]=s,p=(0,o.useMemo)(()=>{let t=l||g()||void 0,n=(0,a.Mx)(s,t);if(void 0!==t&&(e._config.theme=t),e._parentEditor=u,r)for(let t of r){let r=null,l=null;if("function"!=typeof t){let e=t;t=e.replace,r=e.with,l=e.withKlass||null}let n=e._nodes.get(t.getType());e._nodes.set(t.getType(),{exportDOM:n?n.exportDOM:void 0,klass:t,replace:r,replaceWithKlass:l,transforms:f(t)})}else for(let[t,r]of e._nodes=new Map(u._nodes))e._nodes.set(t,{exportDOM:r.exportDOM,klass:r.klass,replace:r.replace,replaceWithKlass:r.replaceWithKlass,transforms:f(r.klass)});return e._config.namespace=u._config.namespace,e._editable=u._editable,[e,n]},[]),{isCollabActive:h,yjsDocMap:b}=(0,o.useContext)(c),_=n||i.current||b.has(e.getKey());return(0,o.useEffect)(()=>{_&&(i.current=!0)},[_]),(0,o.useEffect)(()=>u.registerEditableListener(t=>{e.setEditable(t)}),[e,u]),(0,d.jsx)(a.Gu.Provider,{value:p,children:!h||_?t:null})}var p=r(51343),h=r(54464),b=r(21059),_=r(13612),v=r(19934),E=r(14509);function C(){return o.createElement(v.W,{validateUrl:E.wv})}var k=r(42733),w=r(24225),M=r(75148),x=r(51326),A=r(86725),R=r(98982),S=r(43961);let T=/((https?:\/\/(www\.)?)|(www\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;function y({onSubmit:e,values:t,onClose:r}){let{i18n:l}=(0,S.PCX)(),n={component:"Form",validation:{type:"object",properties:{link:{type:"string",errors:{matches:l.formatMessage({id:"invalid_link_url"})},matches:{regex:T,excludeEmptyString:!0},label:l.formatMessage({id:"link_url"})}}},elements:{link:{name:"link",component:"Text",label:l.formatMessage({id:"link_url"}),fullWidth:!0,placeholder:l.formatMessage({id:"link_url"}),variant:"outlined",size:"small"},target:{name:"target",component:"Checkbox",label:l.formatMessage({id:"open_link_in_new_window"}),checkedValue:"_blank",uncheckedValue:"_self",fullWidth:!0,variant:"outlined",size:"small"},footer:{name:"_footer",component:"FormFooter",elements:{submit:{name:"_submit",component:"Submit",label:l.formatMessage({id:"ok"}),variant:"contained",color:"primary"}}}}};return o.createElement(R.ok,{formSchema:n,onSubmit:t=>{e(t),r()},initialValues:t})}var N=r(31965);function I(e,t){let r=e;for(;null!==r&&null!==r.getParent()&&!t(r);)r=r.getParentOrThrow();return t(r)?r:null}let D=new Set,L=(0,_.gu)("RIGHT_CLICK_IMAGE_COMMAND"),P=(0,_.gu)("INSERT_LINK_IMAGE_COMMAND");function F({altText:e,className:t,imageRef:r,src:l,width:n,height:a,maxWidth:i}){if(!D.has(l))throw new Promise(e=>{let t=new Image;t.src=l,t.onload=()=>{D.add(l),e(null)}});return o.createElement("img",{className:t||void 0,src:l,alt:e,ref:r,style:{height:a,maxWidth:i,width:n},draggable:"false"})}function O({src:e,altText:t,nodeKey:r,width:l,height:s,maxWidth:u,resizable:c,showCaption:d,caption:m,captionsEnabled:f}){let v=(0,o.useRef)(null),E=(0,o.useRef)(null),[R,T,D]=(0,h.Y)(r),[O,J]=(0,o.useState)(!1),[z]=(0,a.DF)(),[G,K]=(0,o.useState)(null),W=(0,o.useRef)(null),[U,$]=(0,N.A)(),{i18n:j}=(0,S.PCX)(),B=(0,o.useCallback)(e=>{if(R&&(0,_.RT)((0,_.vJ)())){e.preventDefault();let t=(0,_.ns)(r);(0,w.Eh)(t)&&t.remove()}return!1},[R,r]),H=(0,o.useCallback)(e=>{let t=(0,_.vJ)(),r=E.current;if(R&&(0,_.RT)(t)&&1===t.getNodes().length){if(d)return(0,_.n1)(null),e.preventDefault(),m.focus(),!0;else if(null!==r&&r!==document.activeElement)return e.preventDefault(),r.focus(),!0}return!1},[m,R,d]),Z=(0,o.useCallback)(e=>(W.current===m||E.current===e.target)&&((0,_.n1)(null),z.update(()=>{T(!0);let e=z.getRootElement();null!==e&&e.focus()}),!0),[m,z,T]),V=(0,o.useCallback)(e=>!!O||e.target===v.current&&(e.shiftKey?T(!R):(D(),T(!0)),!0),[O,R,T,D]),q=(0,o.useCallback)(e=>{z.getEditorState().read(()=>{let t=(0,_.vJ)();"IMG"===e.target.tagName&&(0,_.I2)(t)&&1===t.getNodes().length&&z.dispatchCommand(L,e)})},[z]),X=(0,o.useCallback)(e=>{z.update(()=>{!function(e={}){let{target:t,title:r,nodeKey:l,link:n}=e,a=void 0===e.rel?"noreferrer":e.rel;(0,_.rU)().add(l);let i=[(0,_.ns)(l)];if(n){if(1===i.length){let e=I(i[0],M.FJ);if(null!==e){e.setURL(n),void 0!==t&&e.setTarget(t),null!==a&&e.setRel(a),void 0!==r&&e.setTitle(r);return}}let e=null,l=null;i.forEach(i=>{let o=i.getParent();if(!(o===l||null===o||(0,_.ff)(i)&&!i.isInline())){if((0,M.FJ)(o)){l=o,o.setURL(n),void 0!==t&&o.setTarget(t),null!==a&&l.setRel(a),void 0!==r&&l.setTitle(r);return}if(o.is(e)||(e=o,l=(0,M.zA)(n,{rel:a,target:t,title:r}),(0,M.FJ)(o)?null===i.getPreviousSibling()?o.insertBefore(l):o.insertAfter(l):i.insertBefore(l)),(0,M.FJ)(i)){if(i.is(l))return;if(null!==l){let e=i.getChildren();for(let t=0;t<e.length;t++)l.append(e[t])}i.remove();return}null!==l&&l.append(i)}})}else i.forEach(e=>{let t=e.getParent();if((0,M.FJ)(t)){let e=t.getChildren();for(let r=0;r<e.length;r++)t.insertBefore(e[r]);t.remove()}})}(e)})},[z]);(0,o.useEffect)(()=>{let e=!0,t=z.getRootElement(),r=(0,b.Sd)(z.registerUpdateListener(({editorState:t})=>{e&&K(t.read(()=>(0,_.vJ)()))}),z.registerCommand(_.Mv,(e,t)=>(W.current=t,!1),_.Ac),z.registerCommand(_.d8,V,_.Ac),z.registerCommand(L,V,_.Ac),z.registerCommand(P,X,_.Ac),z.registerCommand(_.Tg,e=>e.target===v.current&&(e.preventDefault(),!0),_.Ac),z.registerCommand(_.w$,B,_.Ac),z.registerCommand(_.gC,B,_.Ac),z.registerCommand(_.if,H,_.Ac),z.registerCommand(_.Q$,Z,_.Ac));return null==t||t.addEventListener("contextmenu",q),()=>{e=!1,r(),null==t||t.removeEventListener("contextmenu",q)}},[D,z,O,R,r,B,H,Z,V,q,T,X]);let[Q,Y]=(0,o.useState)(!1),ee=R&&(0,_.RT)(G)&&!O,et=R||O,er=l.toString().includes("%"),el=(0,o.useRef)(null);return o.useLayoutEffect(()=>{var e;let t=null==(e=el.current)?void 0:e.closest(".editor-image");if(Q){null==t||t.style.removeProperty("width");return}null==t||t.style.setProperty("width",l)},[l,Q]),o.createElement(o.Suspense,{fallback:o.createElement("div",{ref:el,style:{width:l}})},o.createElement("div",{ref:el,className:"editor-image-container"},o.createElement("div",{className:"editor-image-item",draggable:ee,style:{position:"relative"}},o.createElement(F,{className:et?`focused ${(0,_.RT)(G)?"draggable":""}`:null,src:e,altText:t,imageRef:v,width:er?"100%":l,height:s,maxWidth:u}),c&&(0,_.RT)(G)&&et&&o.createElement(k.wz,{showCaption:d,setShowCaption:()=>{z.update(()=>{let e=(0,_.ns)(r);(0,w.Eh)(e)&&e.setShowCaption(!0)})},editor:z,buttonRef:E,imageRef:v,maxWidth:u,onResizeStart:()=>{Y(!0),J(!0)},onResizeEnd:(e,t)=>{setTimeout(()=>{J(!1)},200),z.update(()=>{let l=(0,_.ns)(r);(0,w.Eh)(l)&&l.setWidthAndHeight(e,t)})},captionsEnabled:f}),et?o.createElement(A.A,{size:"small",role:"button",onClick:e=>{var t;return t={nodeKey:r},void(e.preventDefault(),z.getEditorState().read(()=>{let{nodeKey:e}=t;(0,_.rU)().add(e);let r=(0,_.ns)(e).getParent(),l=(0,M.FJ)(r)?r.getURL():"",n=((0,M.FJ)(r)?r.getTarget():"")||"_blank";$("rich_text_editor_insert_link",e=>o.createElement(y,{onSubmit:e=>{z.dispatchCommand(P,e)},values:{...t,link:l,target:n},onClose:e}))}))},title:j.formatMessage({id:"rich_text_editor_insert_link"}),sx:{position:"absolute",top:"4px",right:"4px",background:"rgba(0,0,0,0.5) !important","&:hover":{background:"rgba(0,0,0,0.7) !important"}}},o.createElement(x.A,null)):null),d&&o.createElement("div",{className:"image-caption-container"},o.createElement(g,{initialEditor:m},o.createElement(n.x,null),o.createElement(C,null),o.createElement(p.$,{contentEditable:o.createElement(k.ar,{className:"ImageNode__contentEditable"}),placeholder:o.createElement(k.Or,{className:"ImageNode__placeholder"},"Enter a caption..."),ErrorBoundary:i.A}))),U))}}}]);