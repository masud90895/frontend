"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-photo-components-StatusComposerControlAttatchedPhotos-PreviewPhotos"],{71110:function(e,t,o){o.r(t),o.d(t,{default:function(){return M}});var a=o(43961),i=o(25304),l=o(41349),n=o(69508),r=o(86725),s=o(99221),d=o(56332),c=o(20644),u=o.n(c),p=o(30758),m=o(75621),v=o(28017),h=o(63383),f=o(85333);let g="ComposerVideoItem",b=(0,n.Ay)("video",{name:g,slot:"VideoItem"})(({theme:e})=>({width:"100%",maxWidth:"100%",height:"100%",borderRadius:e.shape.borderRadius})),y=(0,n.Ay)(i.s4,{name:g,slot:"CustomPlayButton"})({position:"absolute",top:0,bottom:0,left:0,right:0,margin:"auto",fontSize:"64px",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.3)",color:"#fff"});var A=function({item:e,showImage:t}){let o=null==e?void 0:e.thumbnail,a=t||(null==o?void 0:o.file)||(null==o?void 0:o.image),n=p.useMemo(()=>{if(null==o?void 0:o.image)return(0,l.AE)(null==o?void 0:o.image,"500")},[o]),[r,s]=p.useState(n);return p.useEffect(()=>{(null==o?void 0:o.file)&&(0,f.t)(null==o?void 0:o.file,e=>{s(e)})},[null==o?void 0:o.file]),p.createElement(p.Fragment,null,a?p.createElement(i._V,{draggable:!1,src:`${r||e.source||(null==e?void 0:e.destination)}#t=0.1`,aspectRatio:"169",shape:"radius"}):p.createElement(b,{src:`${e.source||(null==e?void 0:e.destination)}#t=0.1`,draggable:!1,controls:!1,autoPlay:!!l.un&&void 0,muted:!0,playsInline:!0,preload:"metadata"}),p.createElement(y,{onClick:e=>{e.preventDefault(),e.stopPropagation()},icon:"ico-play-circle-o"}))};let E="PreviewPhotos",x=(0,n.Ay)(r.A,{name:E,slot:"remove button"})(({theme:e})=>({position:"absolute",top:e.spacing(2),right:e.spacing(2),zIndex:5,opacity:.9})),C=(0,n.Ay)("div",{name:E,slot:"RemainBackdrop",shouldForwardProp:e=>"allowEditAll"!==e})(({theme:e,allowEditAll:t})=>({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:"rgba(0,0,0,0.3)",borderRadius:e.shape.borderRadius,"&:hover":{backgroundColor:"rgba(0,0,0,0.1)"},...t&&{cursor:"pointer"}})),k=(0,n.Ay)("div",{name:E,slot:"Root"})(({theme:e})=>({display:"block",position:"relative",overflow:"hidden",margin:e.spacing(1.5)})),w=(0,n.Ay)("div",{name:E,slot:"ListContainer",shouldForwardProp:e=>"gridType"!==e})(({theme:e,gridType:t})=>({position:"relative",display:"flex",flexWrap:"wrap"})),_=(0,n.Ay)("div",{name:E,slot:"ItemRoot",shouldForwardProp:e=>"itemIndex"!==e&&"gridType"!==e})(({theme:e,itemIndex:t,gridType:o})=>({position:"relative",display:"flex",flexBasis:"50%",padding:e.spacing(.5),..."preset1"===o&&"item0"===t&&{flexBasis:"100%"},..."preset3"===o&&"item0"===t&&{flexBasis:"100%"}})),P=(0,n.Ay)("div",{name:E,slot:"RemainText"})(({theme:e})=>({color:"white",position:"absolute",left:"50%",top:"50%",fontSize:"2rem",transform:"translate(-50%,-50%)"})),R=(0,n.Ay)("div",{name:E,slot:"ActionBar"})(({theme:e})=>({position:"absolute",top:0,right:0,left:0,display:"flex",zIndex:5,flexDirection:"row",padding:e.spacing(2),justifyContent:"space-between"})),I=(0,n.Ay)("div",{name:E,slot:"ButtonGroup"})(({theme:e})=>({"& > *":{marginRight:`${e.spacing(1)} !important`},[e.breakpoints.down("sm")]:{display:"flex",flexDirection:"column",margin:e.spacing(-1.5,-1,-1),"& button":{marginTop:e.spacing(.5)}}})),z=(0,n.Ay)("div",{name:E,slot:"VideoWrapper"})(({theme:e})=>({width:"100%",display:"block",position:"relative",borderRadius:e.shape.borderRadius,overflow:"hidden","&:before":{paddingBottom:"56.25%",content:'""',display:"block"}})),B=(0,n.Ay)(s.A,{name:E,slot:"VideoInner"})(({theme:e})=>({top:0,left:0,right:0,bottom:0,position:"absolute"})),S=(0,n.Ay)(s.A)(({theme:e})=>({backgroundColor:"rgba(0,0,0,0.4)",aspectRatio:"16 / 9",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontSize:e.mixins.pxToRem(16),padding:e.spacing(1),borderRadius:e.shape.borderRadius}));function M({composerRef:e,isEdit:t,parentUser:o,submitting:n}){let{i18n:r,dialogBackend:c,getAcl:f,ParserPreviewPhoto:g}=(0,a.PCX)(),b=p.useRef(),{acceptTypes:y}=(0,h.A)({parentUser:o}),[E,M]=(0,m.A)(e,b,{parentUser:o,acceptTypes:y}),$=u()(e.current.state,"attachments.photo.value"),D=u()(e.current.state,"extra"),T=u()(e.current.state,"post_as_parent"),V=f(),j=p.useCallback((t,o)=>{let a=u()(e.current.state,"attachments.photo.value"),i=(0,v.Ay)(a,e=>{let a=e.find(e=>(null==t?void 0:t.uid)&&(null==e?void 0:e.uid)===t.uid||(null==t?void 0:t.id)&&(null==e?void 0:e.id)===(null==t?void 0:t.id));a&&Object.assign(a,o)});e.current.setAttachments("photo","photo",{as:"StatusComposerControlAttachedPhotos",value:i})},[e]),F=p.useCallback(()=>{e.current.removeAttachmentName("photo")},[e]),W=p.useCallback(t=>{let o=u()(e.current.state,"attachments.photo.value"),a=(0,v.Ay)(o,e=>e.filter(e=>e.uid!==t.uid||e.id!==t.id));e.current.setAttachments("photo","photo",{as:"StatusComposerControlAttachedPhotos",value:a})},[e]),L=p.useCallback(()=>{c.present({component:"photo.dialog.EditPreviewPhotosDialog",props:{composerRef:e,isEdit:t,parentUser:o,postAsParent:T}})},[e,c,t,T,o]),N=p.useCallback(e=>{c.present({component:"photo.dialog.EditPreviewPhotoDialog",props:{item:e,postAsParent:T,parentUser:o}}).then(t=>{t&&j(e,t)})},[c,j,T,o]),O=(({acl:e})=>{let t=u()(e,"photo.photo.create"),o=u()(e,"video.video.create");return t&&o?"add_photos_video":o?"add_videos":"add_photos"})({acl:V}),G=(null==$?void 0:$.length)||0;if(!G)return null;let X=Math.min(G,4)%5,q=G-X,H=!!(1<G||!t||(null==D?void 0:D.can_edit_feed_item)),J=()=>{H&&L()};return p.createElement(k,{"data-testid":"previewAttachPhoto"},p.createElement(w,null,G?$.slice(0,X).map((e,t)=>{var o;return p.createElement(_,{gridType:`preset${X}`,itemIndex:`item${t}`,key:(null==e?void 0:e.uid)||(null==e?void 0:e.id)},p.createElement(s.A,{sx:{position:"relative",width:"100%"}},(null==e?void 0:e.is_processing)?p.createElement(S,null,p.createElement(i.s4,{icon:"ico-loading-icon",sx:{fontSize:"24px"}}),p.createElement(s.A,{mt:1},r.formatMessage({id:"video_is_being_processed"}))):(0,l.EL)(null==(o=e.file)?void 0:o.type)||(null==e?void 0:e.resource_name)==="video"||(null==e?void 0:e.type)==="video"?p.createElement(z,null,p.createElement(B,null,p.createElement(A,{item:e,showImage:l.un}))):p.createElement(g,{item:e,onParse:t=>j(e,t),onError:()=>W(e),isAbort:n,sx:{borderRadius:e=>`${e.shape.borderRadius}px`,overflow:"hidden"}},p.createElement(i._V,{draggable:!1,src:e.base64||e.source||(null==e?void 0:e.destination)||(0,l.AE)(null==e?void 0:e.image),aspectRatio:"169",shape:"radius"})),0<q&&X===t+1?p.createElement(C,{onClick:J,allowEditAll:H},p.createElement(P,null,`+ ${q}`)):null))}):null),p.createElement(R,null,!t||(null==D?void 0:D.can_edit_feed_item)?p.createElement(I,null,1===G?p.createElement(d.A,{variant:"contained",size:"smaller",color:"default",onClick:()=>N($[0]),startIcon:p.createElement(i.s4,{icon:"ico-pencil"})},r.formatMessage({id:"edit"})):p.createElement(d.A,{variant:"contained",size:"smaller",color:"default",onClick:L,startIcon:p.createElement(i.s4,{icon:"ico-pencil"})},r.formatMessage({id:"edit_all"})),p.createElement(d.A,{variant:"contained",size:"smaller",color:"default",onClick:M,startIcon:p.createElement(i.s4,{icon:"ico-plus"})},r.formatMessage({id:O}))):null,p.createElement("input",{type:"file",className:"srOnly",ref:b,onChange:E,multiple:!0,accept:y})),t?null:p.createElement(x,{size:"smallest",onClick:F,variant:"blacked",title:r.formatMessage({id:"remove_all"})},p.createElement(i.s4,{icon:"ico-close"})))}}}]);