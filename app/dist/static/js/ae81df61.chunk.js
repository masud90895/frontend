"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["metafox-core-blocks-ListingOnMap-Block"],{54648:function(e,t,a){a.r(t),a.d(t,{default:function(){return W}});var o=a(43961),n=a(25304),l=a(69508),i=a(27759),r=a(53770),s=a(17295),c=a(36694),d=a(89507),g=a(54908),p=a(99221),u=a(75969),m=a(98002),h=a.n(m),f=a(20644),v=a.n(f),y=a(30758),x=a(2675),w=a(41349),E=a(19957),k=a(1530),b=a(24009),S=a(76534),A=a(59122);let C=(0,l.Ay)("div",{name:"titleStyled"})(({theme:e})=>({color:e.palette.grey[700]})),R=(0,l.Ay)("div")(({theme:e})=>({position:"absolute",right:e.spacing(7.5),top:e.spacing(1.2),backgroundColor:"#ffffff",height:e.spacing(5),borderRadius:e.spacing(1),'[dir="rtl"] &':{right:"inherit",left:e.spacing(7.5)},"& .MuiInputBase-root":{width:"320px",height:"40px !important",borderRadius:e.spacing(1)},"& input":{padding:e.spacing(1.75,1.75),color:"black",marginRight:e.spacing(3)},"& input::placeholder":{color:e.palette.grey[700]},[e.breakpoints.down("sm")]:{position:"absolute!important",top:"-50px",width:"calc(100% - 32px)!important",left:e.spacing(2),"& .MuiInputBase-root":{width:"100%!important"},marginRight:e.spacing(2)}})),$=(0,l.Ay)("span")(({theme:e})=>({paddingLeft:e.spacing(1),color:e.palette.text.secondary})),_=(0,l.Ay)("span")(({theme:e})=>({color:e.palette.text.primary})),B=(0,l.Ay)(n.s4)(({theme:e})=>({color:e.palette.text.secondary,fontSize:e.mixins.pxToRem(13),paddingRight:e.spacing(1)})),z=(0,l.Ay)("div")(({theme:e})=>({flexDirection:"row",alignItems:"center",padding:e.spacing(1,1),whiteSpace:"nowrap",fontSize:e.mixins.pxToRem(15),cursor:"pointer","&:hover":{backgroundColor:e.palette.action.focus},overflow:"hidden",textOverflow:"ellipsis",WebkitBoxOrient:"vertical",WebkitLineClamp:1})),F=(0,l.Ay)(i.A)(({theme:e})=>({padding:e.spacing(1,1),marginTop:"0px"})),I=(0,l.Ay)(r.A)(({theme:e})=>({zIndex:1e3,width:"320px",maxHeight:"300px",overflowY:"auto",[e.breakpoints.down("sm")]:{width:"100%"}})),M=(0,l.Ay)("div")(({theme:e})=>({position:"absolute",top:"50%",right:0,transform:"translate(-14px, -50%)",cursor:"pointer",color:e.palette.grey.A700})),O=(0,l.Ay)("div")(({theme:e})=>({display:"block",position:"relative","& .map":{backgroundColor:e.palette.action.focus,height:"100%",width:"100%",position:"absolute",top:0,left:0},"& .gm-ui-hover-effect":{background:"white !important",width:"20px !important",height:"20px !important",right:"2px !important","& span":{margin:"0 !important"}},"& .gm-style-iw + button":{display:"none"}}));var W=(0,o.WvA)({extendBlock:function({fixedView:e}){let t=(0,o.alo)(),a=y.useRef(),[l,i]=y.useState(""),{usePageParams:r,navigate:m,dispatch:f,assetUrl:W,i18n:L,usePreference:P}=(0,o.PCX)(),V=r(),{appName:T}=V,H=(0,b.d4)(e=>v()(e,`${T}.${T}Active`)),N=(0,o.IgF)(T,T,"viewItemsOnMap"),Z=(0,w.FI)(V,null==N?void 0:N.apiRules),{search:q}=(0,x.zy)(),D=(0,y.useMemo)(()=>new URLSearchParams(q),[q]),G=y.useRef(),K=y.useRef(),U=(0,b.d4)(e=>(0,o.qRQ)(e,`${null==N?void 0:N.apiUrl}?${S.stringify(Z)}`)),Q=(0,b.d4)(e=>(0,o.OG_)(e,null==U?void 0:U.ids)),{userLanguage:X}=P(),Y=o.uO7,{isLoaded:j}=(0,E.RH)({googleMapsApiKey:Y,libraries:["places"],language:X||o.mg_}),[J,ee]=y.useState([]),[et,ea]=y.useState({loading:!1,error:!1}),[eo,en]=y.useState(!1),[el,ei]=(0,y.useState)({lat:(parseFloat(D.get(A._x))+parseFloat(D.get(A.gz)))/2||0,lng:(parseFloat(D.get(A.C0))+parseFloat(D.get(A.o6)))/2||0}),[er,es]=(0,y.useState)(null),ec=(0,y.useMemo)(()=>null==er?void 0:er.getZoom().toString(),[er]),ed=(0,y.useMemo)(()=>parseInt(D.get(A.c2))||ec||15,[D.get(A.c2),ec]),eg=y.useCallback(e=>{es(e);try{K.current=new google.maps.Geocoder,K.current.geocode({location:el}).then(e=>{e.results[0]?i(e.results[0].formatted_address):i("")})}catch(e){}D.get(A._x)||navigator.geolocation.getCurrentPosition(e=>{ei({lat:e.coords.latitude,lng:e.coords.longitude})},()=>{}),G.current=new google.maps.places.PlacesService(e)},[]),ep=(0,y.useRef)(null),eu=(0,o.Woi)(ep).style,em=y.useCallback(e=>{G.current&&(null==e?void 0:e.query)&&(ea(e=>({...e,loading:!0})),G.current.textSearch(e,(e,t)=>{"OK"===t&&(ee(e.map(e=>({icon:e.icon,name:e.name,address:e.formatted_address,lat:e.geometry.location.lat(),lng:e.geometry.location.lng()}))),ea(e=>({...e,loading:!1})))}))},[l]);y.useEffect(()=>{em({query:l})},[l]),(0,y.useEffect)(()=>{l&&eh()},[el]);let eh=()=>{if(j&&er){let e=er.getBounds().getSouthWest().lng(),t=er.getBounds().getNorthEast().lng(),a=er.getBounds().getSouthWest().lat(),o=er.getBounds().getNorthEast().lat();D.set(A.C0,t.toString()),D.set(A.gz,o.toString()),D.set(A._x,a.toString()),D.set(A.o6,e.toString()),D.set(A.c2,er.getZoom().toString()),m({search:D.toString()},{replace:!0})}},ef=()=>{f({type:`${T}/hover`,payload:""})};if((0,y.useEffect)(()=>()=>{ep.current=null},[]),(0,y.useEffect)(()=>{(null==U?void 0:U.loading)&&ef()},[null==U?void 0:U.loading]),!j)return;let ev={url:W(`${T}.map_marker_hover`),scaledSize:new google.maps.Size(52,52)},ey={url:W(`${T}.map_marker`),scaledSize:new google.maps.Size(44,44)};return y.createElement(k.eB,null,y.createElement(O,{"data-testid":"mapSearchView",ref:ep},y.createElement("div",{style:e?{...eu,...t?{top:180}:{}}:{position:"static",height:"0",paddingBottom:"100%"}},j?y.createElement(E.u6,{mapContainerStyle:{},center:el,zoom:ed,onLoad:eg,mapContainerClassName:"map",onDragEnd:()=>{ef(),setTimeout(()=>{eh()},200)},onZoomChanged:()=>{ef(),q&&setTimeout(()=>{eh()},200)},options:{gestureHandling:"cooperative"}},Q.map(({id:e,title:t,location:a})=>y.createElement(E.pH,{icon:H===`${T}Active${e}`?ev:ey,key:e,position:{lat:parseFloat(null==a?void 0:a.lat),lng:parseFloat(null==a?void 0:a.lng)},onClick:()=>{var t;return t=`${T}Active${e}`,void(document.getElementById(t).scrollIntoView(!1),t!==H&&f({type:`${T}/hover`,payload:t}))}},H===`${T}Active${e}`?y.createElement(E.Fu,{position:{lat:parseFloat(null==a?void 0:a.lat),lng:parseFloat(null==a?void 0:a.lng)},onCloseClick:()=>ef()},y.createElement(C,null,t)):null))):null,y.createElement(s.x,{onClickAway:()=>en(!1)},y.createElement("div",null,y.createElement(R,null,y.createElement(c.A,{sx:{width:"100%"},inputRef:a,onChange:e=>{i(e.target.value),en(!0)},value:l,inputProps:{"data-testid":h()("field")},placeholder:L.formatMessage({id:"search_by_location"})}),y.createElement(d.A,{title:L.formatMessage({id:"your_location"}),placement:"bottom"},y.createElement(M,{onClick:()=>{navigator.geolocation.getCurrentPosition(e=>{ei({lat:e.coords.latitude,lng:e.coords.longitude})},()=>{})}},y.createElement(n.s4,{icon:"ico-target-o"})))),y.createElement(I,{open:eo,anchorEl:a.current,placement:"bottom-start",sx:{borderRadius:1}},y.createElement(F,null,y.createElement(g.A,{in:eo},et.loading?y.createElement(p.A,null,y.createElement(u.A,{animation:"wave",height:30,width:"100%"}),y.createElement(u.A,{animation:"wave",height:30,width:"100%"}),y.createElement(u.A,{animation:"wave",height:30,width:"100%"})):J.map(e=>y.createElement(z,{key:e.lat,onClick:()=>(e=>{let t=e.address.search(","),a={address:e.address.slice(0,t)===e.name?`${e.address}`:`${e.name}, ${e.address}`,lat:e.lat,lng:e.lng};en(!1),i(a.address),ei({lat:e.lat,lng:e.lng})})(e)},y.createElement(B,{icon:"ico-checkin"}),y.createElement(_,null,e.name),y.createElement($,null,e.address)))))))))))},defaults:{fixedView:!0},custom:{fixedView:{name:"fixedView",component:"Checkbox",label:"Layout fixed",fullWidth:!0,checkedValue:!0}}})}}]);