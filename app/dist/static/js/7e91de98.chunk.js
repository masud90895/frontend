"use strict";(self.webpackChunk_metafox_react=self.webpackChunk_metafox_react||[]).push([["NotificationWebPush"],{78482:function(e,t,i){let r;i.r(t),i.d(t,{default:function(){return W}});var o,s=i(43961),n=i(69508),a=i(99221),c=i(18851),l=i(56332),p=i(30758),d=i(15149),u=i(62336),f=i(25878),h=i(42527),g=i(19694);function m(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let b=new class{bootstrap(e,t){this.manager=e,this.settingApp=this.manager.getSetting("firebase"),this.settingApp&&this.init(this.settingApp,t)}checkActive(){return this.isActive}init(e,t){if(this.mounted)return this.firebaseApp;this.mounted=!0;let i={apiKey:s.z0J,authDomain:s.wRL,projectId:s.wWR,storageBucket:s.npo,messagingSenderId:s.AfL,appId:s.Kou};this.config=e;try{let e=(0,u.Wp)(i),r=(0,h.xI)(e),{user_firebase_email:o,user_firebase_password:s,requiredSignin:n}=this.settingApp||{};return n&&(0,h.x9)(r,o,s).then(e=>{}).catch(e=>{console.log("Live Video - Firebase signInWithEmailAndPassword error",e),"auth/user-not-found"===e.code&&(0,h.eJ)(r,o,s)}),t(!0),this.firebaseApp=e,this.isActive=!0,e}catch(e){this.isActive=!1}}getFirebaseApp(){return this.firebaseApp}getFirestore(){if(!this.firebaseApp)return null;if(!this.firestore){let e=(0,f.aU)(this.firebaseApp);e&&(this.firestore=e)}return this.firestore}getMessaging(){if(!this.firebaseApp)return null;if(!this.cloudMessage){let e=(0,g.dG)(this.firebaseApp);e&&(this.cloudMessage=e)}return this.cloudMessage}constructor(){m(this,"firestore",void 0),m(this,"config",void 0),m(this,"mounted",void 0),m(this,"settingApp",void 0),m(this,"cloudMessage",void 0),m(this,"firebaseApp",void 0),m(this,"isActive",void 0),m(this,"manager",void 0)}},A=!1,v=!1,w=(0,n.Ay)(a.A,{name:"Wrapper",slot:"root"})(({theme:e})=>({position:"fixed",top:16,width:"auto",right:16,zIndex:1301})),x=(0,n.Ay)(a.A,{name:"Inner",slot:"root"})(({theme:e})=>({minWidth:"100px",maxWidth:"25vw",padding:e.spacing(2),backgroundColor:e.palette.background.paper,color:e.palette.text.primary,borderRadius:e.shape.borderRadius,boxShadow:e.shadows[20],[e.breakpoints.down("md")]:{maxWidth:"calc(100vw - 32px)"}})),k=(0,n.Ay)(a.A,{name:"Content",slot:"root"})(({theme:e})=>({paddingBottom:e.spacing(1),marginBottom:e.spacing(1),borderBottomStyle:"solid",borderBottomWidth:1,borderBottomColor:e.palette.divider})),y=(0,n.Ay)(a.A,{name:"ButtonWrapper",slot:"root"})(({theme:e})=>({display:"flex",justifyContent:"flex-end",button:{marginLeft:e.spacing(1)}}));var C=((o=C||{}).Default="0",o.Skip="1",o.Accept="2",o);function W(){let{i18n:e,cookieBackend:t,dispatch:i,useLoggedIn:o,useIsMobile:n}=(0,s.PCX)(),[,a,u]=function(){let[e,t]=p.useState(),[i,o]=p.useState(!1),[n,a]=function(){let e=(0,s.PCX)(),[t,i]=p.useState(!1);return t||A||(A=!0,b.bootstrap(e,()=>{v=!0,i(!0)})),[t||v,b]}(),c=p.useRef(0);if(!n)return["",()=>{},!0];if(!r&&!i&&n)try{r=a.getMessaging()}catch(e){o(!0)}let l=e=>{(0,d.gf)(r).then(i=>{e(i),t(i)}).catch(()=>{c.current>5||(c.current=c.current+1,l(e))})};return[e,l,i]}(),[f,h]=p.useState(!0),g="1"===t.get("fcm-notification"),m="2"===t.get("fcm-notification"),C=!!t.get("fcm-token"),W=o(),S=n(!0),M=()=>{a&&a(e=>{i({type:"@registerFCM",payload:{token:e}})})},E=p.useCallback((e="1")=>{t.set("fcm-notification",e,{expires:30})},[]),I=p.useCallback(()=>{h(!1),E()},[]),P=()=>{"Notification"in window?"granted"===Notification.permission?M():"denied"!==Notification.permission?Notification.requestPermission().then(e=>{if("granted"===e)return void M();E("1")}):E("1"):alert("This browser does not support desktop notification")};return(p.useEffect(()=>{s.SDN||m&&!C&&(E("1"),P())},[]),s.SDN||m||g||!f||!W||u||S)?null:p.createElement(w,null,p.createElement(x,null,p.createElement(k,null,p.createElement(c.A,{variant:"body1",component:"span"},e.formatMessage({id:"web_push_consent_desc"}))),p.createElement(y,null,p.createElement(l.A,{"data-testid":"cancelWebPush",role:"button",tabIndex:2,variant:"text",disableRipple:!0,size:"small",color:"primary",onClick:I},e.formatMessage({id:"skip"})),p.createElement(l.A,{"data-testid":"allowWebPush",role:"button",tabIndex:1,autoFocus:!0,variant:"contained",disableRipple:!0,size:"small",color:"primary",onClick:()=>{h(!1),E("2"),P()}},e.formatMessage({id:"accept"})))))}}}]);